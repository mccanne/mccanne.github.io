files=["./pump-data-bg.csv","./pump-data-insulin.csv","./cgm.csv"];function select_tab(a){d3.select("#hourly_tab").attr("class","inactive");d3.select("#day_tab").attr("class","inactive");d3.select("#detail_tab").attr("class","inactive");d3.select("#hourly_tab_cgm").attr("class","inactive");d3.select("#day_tab_cgm").attr("class","inactive");d3.select(a).attr("class","active")}function data_ready(){var b=telemetry.midnight(telemetry.maxDate);var a=telemetry.midnight(add_days(b,-13));log(a);log(b);draw_dashboard(a,b)}function draw_dashboard(a,d){dashboard_clear();this.ts_bgs=telemetry.selectBGs(a,d);var c=telemetry.selectCarbs(a,d);var f=telemetry.selectBolus(a,d);var i=telemetry.selectBasal(a,d);var g=d3.select("#dashboard");var b=parseInt(g.style("width"));var e=Math.round(0.67*b);dbd.init(g,a,d,b,e);dbd.data(ts_bgs,c,f,i);select_tab("#day_tab");dbd.set_mode("scatter");d3.select("#db-edate").attr("value",friendly_date3(d)).attr("startDate",a).attr("endDate",d)}function dashboard_clear(){d3.select("#dashboard").selectAll("svg").remove()}function dashboard_resize(){data_ready()}var resize_callback=undefined;function check_for_resize(){log("c");dashboard_clear();if(resize_callback!=undefined){clearTimeout(resize_callback)}resize_callback=setTimeout(function(){dashboard_resize()},500)}d3.select(window).on("resize",function(){check_for_resize()});function set_daily(){dbd.set_mode("scatter");select_tab("#day_tab")}function set_hourly(){dbd.set_mode("dist");select_tab("#hourly_tab")}function set_detail(){dbd.set_mode("detail");select_tab("#detail_tab")}function set_day_by_day_cgm(){dbd.plot("day",ts_cgm);select_tab("#day_tab_cgm")}function set_hourly_cgm(){dbd.plot("bg",ts_cgm);select_tab("#hourly_tab_cgm")}function sidebar_select(a){log("SIDEBAR: "+a)}var sidebar_info=[{heading:"Sugarbook"},{text:"Dashboard",onclick:"build_dashboard()"},{text:"Daily detail",onclick:"build_app_unimp()"},{text:"Long-term Detail",onclick:"build_app_unimp()"},{heading:"Pals"},{text:"Current pals",onclick:"build_app_unimp()"},{text:"Invite pals",onclick:"build_app_unimp()"},{text:"Chat",onclick:"build_app_unimp()"},{heading:"Messages"},{text:"Notifications",onclick:"build_notifications()"},{text:"Alerts",onclick:"build_app_unimp()"},{heading:"Devices"},{text:"Sync pump",onclick:"build_app_unimp()"},{text:"Sync CGM",onclick:"build_app_unimp()"},{text:"Sync fitbit",onclick:"build_app_unimp()"},{text:"Settings",onclick:"build_app_unimp()"},{text:"Add device",onclick:"build_app_unimp()"}];var site_items=[{text:"Home",onclick:"build_home()",id:"hometest"},{text:"About",onclick:"build_about()"},{text:"Tutorials",onclick:"build_main_unimp()"},{text:"Blogs",onclick:"build_main_unimp()"},{text:"Related Sites",onclick:"build_main_unimp()"},{text:"Contact Us",onclick:"build_main_unimp()"}];var user_items=[{text:"Profile",onclick:"build_main_unimp()"},{text:"-divider-"},{text:"Signout",onclick:"build_main_unimp()"}];function init_app_frame(){var a=new bamba("root");a.navbar("GreenDotz","electra@greendotz.org",0,user_items,site_items).container().id("bamba_permanent");reset_main_frame()}function reset_main_frame(){d3.select("#bamba_dynamic").remove();var a=new bamba("bamba_permanent");return a.div().id("bamba_dynamic")}function unimp(a){var c="<h1>Under construction...!</h1>";a.div().div("class=hero-unit").html(c).pop().p().text("This page under contruction...").pop().pop()}function build_main_unimp(){var a=reset_main_frame();unimp(a)}function build_about(){var c="<h1>Welcome to sugarpals!</h1>";c+="<p><p>";c+="Sugarpals is your on-line place for understanding and tracking your blood sugar, insulin, carb intake, and physical activity.  Diabetes sucks, but it doesn't have to be hard.  Sugarpals will make dealing with diabetes easier for you.  And it can even be fun!";var a=reset_main_frame();a.div().div("class=hero-unit").html(c).pop().p().text("This page under contruction...").pop().pop()}function build_app_unimp(){d3.select("#app-child").remove();var a=new bamba("app-parent");unimp(a.div().id("app-child"))}function select_green_dots(){dbd.set_mode("simple")}function select_detail_dots(){dbd.set_mode("detail")}function build_notifications(){d3.select("#app-child").remove();var a=new bamba("app-parent");a.div().id("app-child").vbox(10).hbox().h(2,"Recent Updates");build_fake_updates(a)}function draw_viewer(b,g,k){var c=telemetry.selectBGs(b,g);var e=telemetry.selectCarbs(b,g);var j=telemetry.selectBolus(b,g);var d=telemetry.selectBasal(b,g);var a=d3.select("#viewer");var i=parseInt(a.style("width"));var f=Math.round(0.6*i);viewer.init(a,b,g,i,f);viewer.plot(c,e,j,d)}function build_viewer(){var b=add_days(midnight(telemetry.maxDate),1);var a=add_days(b,-13);build_viewer_at(a,b,b)}function build_viewer_at(c,d,e){d3.select("#app-child").remove();var a=new bamba("app-parent");a.div().id("app-child").well().h(2,"Daily Viewer").hr().div("class=clearfix").push("label").text("Date").pop().div("class=input").push("input").attr("value","5/28/2012").id("viewer-edate").pop().pop().pop().div().id("viewer").pop().pop();draw_viewer(c,d,e)}function build_dashboard(){d3.select("#app-child").remove();var a=new bamba("app-parent");a.div().id("app-child").well().h(2,"Electra's sugarbook").hr().div("class=clearfix").push("label").text("Date").pop().div("class=input").push("input").attr("class","form-inline").attr("value","6/2/2012").id("db-edate").pop().pop().pop().tab_menu([{text:"Sugar by Day",id:"day_tab",onclick:"set_daily()"},{text:"Sugar by Hour",id:"hourly_tab",onclick:"set_hourly()"},{text:"Sugar detail",id:"detail_tab",onclick:"set_detail()"}]).div().id("dashboard").pop().pop();a.vbox(10).hbox().h(2,"Recent Updates");build_fake_updates(a);load_telemetry(files,data_ready);init_edate_datepicker()}function init_edate_datepicker(){var a=$("#db-edate");a.datepicker({format:"m/d/yyyy"});a.datepicker().on("changeDate",function(d){var c=new Date(d.date);var b=telemetry.midnight(add_days(c,-13));if(c.valueOf()>telemetry.midnight(telemetry.maxDate)){c=telemetry.midnight(telemetry.maxDate);b=add_days(c,-13)}if(b.valueOf()<telemetry.midnight(telemetry.minDate)){b=telemetry.minDate;c=add_days(c,13)}a.attr("value",c);a.text(friendly_date3(c));a.datepicker("hide");a.attr("class","inactive");a.blur();dashboard_clear();draw_dashboard(b,c)})}function build_fake_update(d,b,c){var a="From ";a+=d;a+=" "+b;a+='<div class="well">';a+="<p>"+c+"</p></div>";return a}function build_fake_updates(a){var c='<span class="label label-success">dad</span>';var g='<span class="label label-success">mom</span>';var d='<span class="label label-inverse">fitbit</span>';var f='<span class="label label-inverse">pump</span>';var e="<p><p>";e+=build_fake_update(c,"8:37am today","hey electra, remember to do temp basal before PE today... I set a sugarpals alarm to remind you an hour before");e+=build_fake_update(g,"8:46am today","oops we forgot to bolus for breakfast... correcting BG now");e+=build_fake_update(d,"7:05am today","Detected first activity of day.");e+=build_fake_update(d,"9:37pm yesterday","Detected sleep.");e+=build_fake_update(f,"7:32pm yesterday",'Pumped synced to <a href="http://www.sugarpals.org">sugarpals</a>.');a.div().html(e).pop()}function build_home(){var a=reset_main_frame();a.hbox().vbox(2).sidebar(sidebar_info).pop().vbox(10).id("app-parent");build_dashboard()}tooltip.init();init_app_frame();build_home();d3.select("#hometest").attr("class","active");